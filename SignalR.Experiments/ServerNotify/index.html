<!DOCTYPE html>
<html>
<head>
    <title>SignalR Server Time</title>
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }
    </style>
</head>
    <body>
        <h1>Server Time</h1>
        <h2>numer events <span id="nr_updates">x</span></h2>
        <div class="container form-horizontal">
            your name: <input type="text" id="displayname" /><br/>
            your message: <input type="text" id="message" /> <br/>
            <input type="button" id="sendmessage" value="Send" class="btn btn-lg btn-success" />
            <ul id="discussion">
            </ul>
        </div>
    
        <!-- bootstrap -->
        <link href="Content/bootstrap.css" rel="stylesheet" />

        <!--Script references. -->
        <!--Reference the jQuery library. -->
        <script src="Scripts/jquery-1.9.1.js"></script>
    
        <script src="Scripts/bootstrap.js"></script>

        <!--Reference the SignalR library. -->
        <script src="Scripts/jquery.signalR-2.0.1.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="/signalr/hubs"></script>
        <!--Add script to update the page and send messages.--> 
        <script type="text/javascript">
            var nrEvents = 0;
            $(function () {
                // Declare a proxy to reference the hub. 
                var chat = $.connection.timeChatHub;
                // Create a function that the hub can call to broadcast messages.
                chat.client.broadcastMessage = function (timeChatInfo) {
                    // Html encode display name and message. 
                    var encodedName = $('<div />').text(timeChatInfo.Name).html();
                    var encodedMsg = $('<div />').text(timeChatInfo.Message).html();
                    // Add the message to the page. 
                    $('#discussion').prepend('<li><strong>' + encodedName+ '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');

                    if (timeChatInfo.Message =='clear') {
                        //alert('zebra');
                        $('#discussion').html("");
                    }

                    nrEvents++;
                    $('#nr_updates').text(nrEvents);
                };
                // Get the user name and store it to prepend to messages.
                //$('#displayname').val(prompt('Enter your name:', ''));
                //// Set initial focus to message input box.  
                //$('#message').focus();
                // Start the connection.
                $.connection.hub.start().done(function () {
                    $('#sendmessage').click(function () {
                        // Call the Send method on the hub. 
                        chat.server.send($('#displayname').val(), $('#message').val());
                        // Clear text box and reset focus for next comment. 
                        $('#message').val('').focus();
                    });
                });
            });
        </script>
    </body>
</html>